
     <!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Veritas AI – Values Survey (Present vs 2075)</title>
  <meta name="description" content="Ternary-plot survey for MIS20070 Section 5: compare current values and 2075 values for policing and public trust." />
  <!-- Plotly CDN -->
  <script src="https://cdn.plot.ly/plotly-2.35.2.min.js" defer></script>
  <style>
    :root{--bg:#0f172a;--card:#111827;--text:#e5e7eb;--muted:#9ca3af;--accent:#60a5fa}
    body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial,sans-serif;background:var(--bg);color:var(--text);margin:0}
    .wrap{max-width:1100px;margin:0 auto;padding:24px}
    .card{background:var(--card);border-radius:18px;padding:18px 20px;box-shadow:0 8px 24px rgba(0,0,0,.25)}
    h1,h2{margin:8px 0 6px}
    .grid{display:grid;gap:16px}
    @media(min-width:960px){.grid-2{grid-template-columns:1fr 1fr}}
    .small{font-size:.9rem;color:var(--muted)}
    .row{display:flex;gap:10px;align-items:center;margin:8px 0}
    input[type=range]{width:100%}
    .pill{display:inline-flex;align-items:center;gap:8px;padding:6px 10px;border-radius:999px;background:#0b1220;color:var(--text);font-size:.85rem;border:1px solid #1f2937}
    .btn{appearance:none;background:var(--accent);color:#0b1220;border:0;border-radius:12px;padding:10px 14px;font-weight:700;cursor:pointer}
    .btn:disabled{opacity:.5;cursor:not-allowed}
    .mono{font-family:ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace}
    .notice{border-left:4px solid var(--accent);padding:10px 12px;background:#0b1220;border-radius:8px}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card" style="margin-bottom:16px">
      <h1>Veritas AI – Values Survey</h1>
      <p>Help us understand how society balances three values in policing. Place one point for <strong>today</strong> and one for the year <strong>2075</strong>. Your responses are anonymous.</p>
      <div class="notice small">
        <strong>Values used (customise if needed):</strong>
        <ul>
          <li><em>A</em> – Transparency & Accountability to the Public</li>
          <li><em>B</em> – Privacy & Civil Liberties (civilians + officers)</li>
          <li><em>C</em> – Operational Effectiveness & Officer Safety</li>
        </ul>
        These are intentionally in tension (no simple either/or). Adapt labels to fit your scenario wording.
      </div>
    </div>

    <div class="grid grid-2">
      <section class="card">
        <h2>Present (2025)</h2>
        <div id="plot-present" style="width:100%;height:420px"></div>
        <div class="row"><span class="pill">A: <span id="a-now-val">34</span>%</span><input id="a-now" type="range" min="0" max="100" value="34" step="1" /></div>
        <div class="row"><span class="pill">B: <span id="b-now-val">33</span>%</span><input id="b-now" type="range" min="0" max="100" value="33" step="1" /></div>
        <div class="row"><span class="pill">C: <span id="c-now-val">33</span>%</span><input id="c-now" type="range" min="0" max="100" value="33" step="1" /></div>
        <div class="small">Sum: <span id="sum-now" class="mono">100</span>% (auto-normalised)</div>
      </section>

      <section class="card">
        <h2>Future (2075)</h2>
        <div id="plot-future" style="width:100%;height:420px"></div>
        <div class="row"><span class="pill">A: <span id="a-fut-val">34</span>%</span><input id="a-fut" type="range" min="0" max="100" value="34" step="1" /></div>
        <div class="row"><span class="pill">B: <span id="b-fut-val">33</span>%</span><input id="b-fut" type="range" min="0" max="100" value="33" step="1" /></div>
        <div class="row"><span class="pill">C: <span id="c-fut-val">33</span>%</span><input id="c-fut" type="range" min="0" max="100" value="33" step="1" /></div>
        <div class="small">Sum: <span id="sum-fut" class="mono">100</span>% (auto-normalised)</div>
      </section>
    </div>

    <section class="card" style="margin-top:16px">
      <h2>Submit</h2>
      <p class="small">One submission per visitor. After submitting, buttons will disable in this browser.</p>
      <div class="row">
        <button id="submit" class="btn">Submit both plots</button>
        <button id="download" class="btn" style="background:#34d399">Download CSV (offline mode)</button>
      </div>
      <p id="status" class="small"></p>
      <details class="small" style="margin-top:8px">
        <summary>Storage settings (Supabase optional)</summary>
        <p>By default, responses are stored locally and you can download a CSV. To store to a database, toggle <span class="mono">USE_SUPABASE</span> to <span class="mono">true</span> below and add your project credentials. Table schema example is included in comments.</p>
      </details>
    </section>

    <section class="card small" style="margin-top:16px">
      <p>Built for MIS20070 Digital Society (Section 5). Adapt wording, export code, and cite assistance appropriately.</p>
    </section>
  </div>

<script>
// ======================= CONFIG =======================
// Toggle this to true when you've created a Supabase project and table
const USE_SUPABASE = false;
// Fill in if USE_SUPABASE === true
const SUPABASE_URL = "";        // e.g., https://your-project.supabase.co
const SUPABASE_ANON_KEY = "";   // anon key from Supabase settings
const SUPABASE_TABLE = "veritas_values";

/* Supabase table schema suggestion (SQL):
create table if not exists veritas_values (
  id uuid primary key,
  created_at timestamptz default now(),
  a_now numeric not null,
  b_now numeric not null,
  c_now numeric not null,
  a_future numeric not null,
  b_future numeric not null,
  c_future numeric not null,
  user_agent text,
  ip_hash text
);
-- Consider enabling Row Level Security and a policy to allow insert with anon key.
*/
// ======================================================

const labels = {
  a: "Transparency & Accountability",
  b: "Privacy & Civil Liberties",
  c: "Operational Effectiveness & Officer Safety"
};

const state = {
  now: { a:34, b:33, c:33 },
  fut: { a:34, b:33, c:33 },
  cache: [] // local submissions (CSV fallback)
};

function normalise(triple){
  const total = Math.max(1, triple.a + triple.b + triple.c);
  const a = Math.round(100 * triple.a / total);
  const b = Math.round(100 * triple.b / total);
  let c = 100 - a - b; // ensure exact 100
  // keep within [0,100]
  c = Math.max(0, Math.min(100, c));
  return {a, b, c};
}

function syncFromSliders(which){
  const aEl = document.getElementById(`a-${which}`);
  const bEl = document.getElementById(`b-${which}`);
  const cEl = document.getElementById(`c-${which}`);
  const triple = normalise({ a: +aEl.value, b: +bEl.value, c: +cEl.value });
  state[which] = triple;
  aEl.value = triple.a; bEl.value = triple.b; cEl.value = triple.c;
  document.getElementById(`a-${which}-val`).textContent = triple.a;
  document.getElementById(`b-${which}-val`).textContent = triple.b;
  document.getElementById(`c-${which}-val`).textContent = triple.c;
  document.getElementById(`sum-${which === 'now' ? 'now':'fut'}`).textContent = triple.a + triple.b + triple.c;
  drawPlot(which);
}

function drawPlot(which){
  const plotId = which === 'now' ? 'plot-present' : 'plot-future';
  const triple = state[which];
  const data = [{
    type: 'scatterternary',
    mode: 'markers',
    a: [triple.a], b: [triple.b], c: [triple.c],
    marker: { size: 12 },
    hovertemplate: `<b>${which === 'now' ? 'Present' : '2075'}</b><br>`+
                   `A (${labels.a}): %{a}%<br>`+
                   `B (${labels.b}): %{b}%<br>`+
                   `C (${labels.c}): %{c}%<extra></extra>`
  }];
  const layout = {
    ternary: {
      sum: 100,
      aaxis: { title: labels.a },
      baxis: { title: labels.b },
      caxis: { title: labels.c }
    },
    margin: { l: 10, r: 10, b: 10, t: 10 },
    paper_bgcolor: '#111827',
    plot_bgcolor: '#111827',
    font: { color: '#e5e7eb' }
  };
  Plotly.react(plotId, data, layout, {displayModeBar: false});
}

function init(){
  ['now','fut'].forEach(which => {
    ['a','b','c'].forEach(k => {
      document.getElementById(`${k}-${which}`).addEventListener('input', () => syncFromSliders(which));
    });
    syncFromSliders(which);
  });

  document.getElementById('submit').addEventListener('click', submitBoth);
  document.getElementById('download').addEventListener('click', downloadCSV);
}

async function submitBoth(){
  const id = crypto.randomUUID();
  const row = {
    id,
    a_now: state.now.a, b_now: state.now.b, c_now: state.now.c,
    a_future: state.fut.a, b_future: state.fut.b, c_future: state.fut.c,
    user_agent: navigator.userAgent
  };

  setStatus('Submitting…');

  try{
    if (USE_SUPABASE){
      // lightweight insert via fetch (no external library needed)
      const res = await fetch(`${SUPABASE_URL}/rest/v1/${SUPABASE_TABLE}`, {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
          'apikey': SUPABASE_ANON_KEY,
          'Authorization': `Bearer ${SUPABASE_ANON_KEY}`
        },
        body: JSON.stringify(row)
      });
      if(!res.ok){
        const text = await res.text();
        throw new Error(`Supabase error: ${res.status} ${text}`);
      }
    } else {
      state.cache.push(row);
    }

    setStatus('Thanks! Your response has been recorded.');
    lockSubmission();
  } catch(err){
    console.error(err);
    setStatus('Error recording response. Try download CSV, or contact the researcher.');
  }
}

function lockSubmission(){
  const btn = document.getElementById('submit');
  btn.disabled = true;
  localStorage.setItem('veritas_submitted', '1');
}

function restoreLock(){
  if(localStorage.getItem('veritas_submitted') === '1'){
    document.getElementById('submit').disabled = true;
  }
}

function setStatus(msg){
  document.getElementById('status').textContent = msg;
}

function downloadCSV(){
  const rows = state.cache.length ? state.cache : [{
    id: crypto.randomUUID(),
    a_now: state.now.a, b_now: state.now.b, c_now: state.now.c,
    a_future: state.fut.a, b_future: state.fut.b, c_future: state.fut.c,
    user_agent: navigator.userAgent
  }];
  const headers = Object.keys(rows[0]);
  const csv = [headers.join(',')].concat(rows.map(r => headers.map(h => r[h]).join(','))).join('\n');
  const blob = new Blob([csv], {type:'text/csv'});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url; a.download = 'veritas_values.csv'; a.click();
  URL.revokeObjectURL(url);
}

// Kick things off when Plotly has loaded
window.addEventListener('load', () => { init(); restoreLock(); });
</script>
</body>
</html>
