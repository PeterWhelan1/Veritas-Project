<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Veritas AI — Values Survey (Present vs 2075)</title>
  <meta name="description" content="MIS20070 Section 5 ternary plot survey with Formspree collection." />
  <script src="https://cdn.plot.ly/plotly-2.35.2.min.js"></script>
  <style>
    :root{--bg:#0b1020;--card:#0f172a;--text:#e6edf6;--muted:#9fb2c7;--accent:#7cc0ff;--ok:#34d399;--warn:#fbbf24;--err:#f87171}
    *{box-sizing:border-box}
    body{margin:0;background:var(--bg);color:var(--text);font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial,sans-serif}
    .wrap{max-width:1100px;margin:0 auto;padding:22px}
    h1{margin:0 0 6px;font-size:clamp(1.4rem,2vw,2rem)}
    h2{margin:8px 0 10px;font-size:1.05rem;color:var(--accent)}
    p{line-height:1.55}
    .grid{display:grid;gap:14px}
    @media(min-width:960px){.grid-2{grid-template-columns:1fr 1fr}}
    .card{background:var(--card);border-radius:18px;padding:16px 18px;box-shadow:0 10px 30px rgba(0,0,0,.28)}
    .pill{display:inline-flex;align-items:center;gap:8px;padding:6px 10px;border-radius:999px;background:#0c1a2c;border:1px solid #1d2b3e;color:var(--muted);font-size:.85rem}
    .row{display:flex;gap:10px;align-items:center;flex-wrap:wrap}
    .small{font-size:.9rem;color:var(--muted)}
    .plot{width:100%;height:440px}
    input[type=range]{width:100%}
    input[type=text],input[type=email]{width:100%;padding:10px;border-radius:10px;border:1px solid #2a3a4f;background:#0c1624;color:var(--text)}
    .btn{appearance:none;background:var(--accent);color:#09121e;border:0;border-radius:12px;padding:10px 14px;font-weight:700;cursor:pointer}
    .btn.secondary{background:#334155;color:#e6edf6}
    .btn.ok{background:var(--ok)}
    .btn:disabled{opacity:.55;cursor:not-allowed}
    .notice{border-left:4px solid var(--accent);padding:10px 12px;background:#0b1526;border-radius:10px}
    .status{margin-top:8px}
    .status.ok{color:var(--ok)}
    .status.err{color:var(--err)}
    .foot{margin-top:18px}
    label a{color:var(--accent)}
  </style>
</head>
<body>
  <div class="wrap" role="main">
    <header class="card" aria-labelledby="title">
      <h1 id="title">Veritas AI — Rebuilding Trust Through Real Accountability</h1>
      <p class="small">Public trust in policing is under strain. Veritas AI turns vast body‑camera archives into actionable oversight by flagging potential misconduct (e.g., excessive force, unlawful searches, discrimination) and assembling short, time‑stamped clips for human review. Civilian faces are auto‑blurred and every AI flag is verified by a human before anything is shared.</p>
      <div class="notice small">
        <strong>What you’re doing on this page:</strong> express how society should balance three values — <em>Transparency & Accountability</em>, <em>Privacy & Civil Liberties</em>, and <em>Operational Effectiveness & Officer Safety</em> — <strong>today</strong> and in <strong>2075</strong>. Place one dot in each triangle or use the sliders; percentages always sum to 100%.
      </div>
    </header>

    <section class="grid grid-2" aria-label="Ternary plots">
      <article class="card">
        <h2>Present (2025)</h2>
        <div id="plot-now" class="plot" role="img" aria-label="Ternary plot for present values"></div>
        <div class="row">
          <span class="pill">A: <span id="now-a-val">34</span>%</span><input id="now-a" type="range" min="0" max="100" step="1" value="34" aria-label="Present A percentage"/>
        </div>
        <div class="row">
          <span class="pill">B: <span id="now-b-val">33</span>%</span><input id="now-b" type="range" min="0" max="100" step="1" value="33" aria-label="Present B percentage"/>
        </div>
        <div class="row">
          <span class="pill">C: <span id="now-c-val">33</span>%</span><input id="now-c" type="range" min="0" max="100" step="1" value="33" aria-label="Present C percentage"/>
        </div>
        <div class="small">Sum: <span id="now-sum">100</span>% (auto‑normalised)</div>
        <div class="row" style="margin-top:6px"><button type="button" class="btn secondary" id="now-clear">Clear dot</button></div>
      </article>

      <article class="card">
        <h2>Future (2075)</h2>
        <div id="plot-fut" class="plot" role="img" aria-label="Ternary plot for future values"></div>
        <div class="row">
          <span class="pill">A: <span id="fut-a-val">34</span>%</span><input id="fut-a" type="range" min="0" max="100" step="1" value="34" aria-label="Future A percentage"/>
        </div>
        <div class="row">
          <span class="pill">B: <span id="fut-b-val">33</span>%</span><input id="fut-b" type="range" min="0" max="100" step="1" value="33" aria-label="Future B percentage"/>
        </div>
        <div class="row">
          <span class="pill">C: <span id="fut-c-val">33</span>%</span><input id="fut-c" type="range" min="0" max="100" step="1" value="33" aria-label="Future C percentage"/>
        </div>
        <div class="small">Sum: <span id="fut-sum">100</span>% (auto‑normalised)</div>
        <div class="row" style="margin-top:6px"><button type="button" class="btn secondary" id="fut-clear">Clear dot</button></div>
      </article>
    </section>

    <section class="card" aria-label="Submission">
      <h2>Submit your two responses</h2>
      <form id="resp-form" action="https://formspree.io/f/xqagazql
        <div class="row">
          <label class="small" for="email">Optional email (for receipt / dedup)</label>
        </div>
        <div class="row" style="max-width:420px"><input id="email" type="email" name="email" placeholder="you@example.com" autocomplete="email" /></div>

        <!-- Hidden payload fields sent to Formspree -->
        <input type="hidden" name="present_a" id="present_a" />
        <input type="hidden" name="present_b" id="present_b" />
        <input type="hidden" name="present_c" id="present_c" />
        <input type="hidden" name="future_a" id="future_a" />
        <input type="hidden" name="future_b" id="future_b" />
        <input type="hidden" name="future_c" id="future_c" />
        <input type="hidden" name="dataset" value="veritas-ai" />

        <div class="row" style="margin-top:8px">
          <label><input type="checkbox" id="consent" required/> <span class="small">I consent to my anonymised responses being used for research & teaching. I understand that individual identities are not collected.</span></label>
        </div>

        <div class="row" style="margin-top:10px">
          <button id="submitBtn" class="btn ok" type="submit">Send my two responses</button>
          <button id="downloadBtn" class="btn secondary" type="button">Download CSV (local backup)</button>
          <span id="status" class="small status" aria-live="polite"></span>
        </div>
      </form>
      <p class="foot small">Duplicate submissions are blocked on this browser. Clear site data to submit again.</p>
    </section>

    <section class="card small" aria-label="Safeguards">
      <h2>Safeguards & limits</h2>
      <ul>
        <li>All civilian faces are blurred by default; clips are reviewed by humans before any sharing.</li>
        <li>Model is trained on verified incidents; flags are prompts for review, not verdicts.</li>
        <li>System logs and rationale are auditable; appeals process supported.</li>
      </ul>
      <p class="foot">Please acknowledge AI assistance where relevant: “Assistance received from Digital Society Assistant (GPT-5), OpenAI.”</p>
    </section>
  </div>

  <script>
    // ======== CONFIG ========
    const LABELS = {
      a: 'Transparency & Accountability',
      b: 'Privacy & Civil Liberties',
      c: 'Operational Effectiveness & Officer Safety'
    };
    const FORMSPREE_ENDPOINT = document.getElementById('resp-form').action; // set your endpoint in the form action
    const LOCK_KEY = 'veritas_lock_v1';

    // ======== State ========
    const state = { now: {a:34,b:33,c:33}, fut: {a:34,b:33,c:33}, cache: [] };

    // ======== Helpers ========
    function normalise(a,b,c){
      const s = Math.max(1, a+b+c);
      const A = Math.round(100*a/s), B = Math.round(100*b/s);
      const C = Math.max(0, Math.min(100, 100 - A - B));
      return {a:A,b:B,c:C};
    }

    function setSliders(prefix, t){
      ['a','b','c'].forEach(k=>{
        const el = document.getElementById(`${prefix}-${k}`);
        el.value = t[k];
        document.getElementById(`${prefix==='now'?'now':'fut'}-${k}-val`).textContent = t[k];
      });
      document.getElementById(prefix==='now'?'now-sum':'fut-sum').textContent = t.a + t.b + t.c;
    }

    function generateGrid(step=5){ // percent step
      const A=[],B=[],C=[];
      for(let a=0;a<=100;a+=step){
        for(let b=0;b<=100-a;b+=step){
          A.push(a); B.push(b); C.push(100-a-b);
        }
      }
      return {A,B,C};
    }

    function layoutFor(title){
      return {
        ternary:{ sum:100, aaxis:{title:LABELS.a}, baxis:{title:LABELS.b}, caxis:{title:LABELS.c}, bgcolor:'rgba(0,0,0,0)' },
        margin:{l:10,r:10,b:10,t:10}, paper_bgcolor:'rgba(0,0,0,0)', plot_bgcolor:'rgba(0,0,0,0)', showlegend:false,
        title:{text:title}
      };
    }

    function tracesFor(triple, grid){
      return [
        { type:'scatterternary', mode:'markers', a:grid.A, b:grid.B, c:grid.C, marker:{size:8,opacity:0}, hoverinfo:'skip', name:'picker' },
        { type:'scatterternary', mode:'markers', a:[triple.a], b:[triple.b], c:[triple.c], marker:{size:12}, name:'selection' }
      ];
    }

    function updateHidden(which){
      const t = state[which];
      const pref = which==='now'?'present':'future';
      document.getElementById(`${pref}_a`).value = t.a;
      document.getElementById(`${pref}_b`).value = t.b;
      document.getElementById(`${pref}_c`).value = t.c;
    }

    function draw(which){
      const id = which==='now'?'plot-now':'plot-fut';
      const el = document.getElementById(id);
      const grid = generateGrid(5);
      const t = state[which];
     Plotly.newPlot(el, tracesFor(t,grid), layoutFor(''), {displayModeBar:false});
        el.on('plotly_click', (ev)=>{
        if(!ev.points||!ev.points.length) return;
        const p = ev.points[0]; if (p.curveNumber!==0) return; // only picker
        const a = Math.round(p.a); const b = Math.round(p.b); const c = 100-a-b;
        state[which] = {a,b,c}; setSliders(which, state[which]); updateHidden(which); draw(which);
      });
    }

    function bindSliders(which){
      ['a','b','c'].forEach(k=>{
        document.getElementById(`${which}-${k}`).addEventListener('input', ()=>{
          const A = +document.getElementById(`${which}-a`).value;
          const B = +document.getElementById(`${which}-b`).value;
          const C = +document.getElementById(`${which}-c`).value;
          state[which] = normalise(A,B,C);
          setSliders(which, state[which]); updateHidden(which); draw(which);
        });
      });
    }

    function loadFromLocal(){
      try{
        const n = JSON.parse(localStorage.getItem('veritas_present')||'null');
        const f = JSON.parse(localStorage.getItem('veritas_future')||'null');
        if(n){ state.now=n; }
        if(f){ state.fut=f; }
      }catch{}
    }

    function saveLocal(){
      localStorage.setItem('veritas_present', JSON.stringify(state.now));
      localStorage.setItem('veritas_future', JSON.stringify(state.fut));
    }

    function setStatus(msg, ok=false){
      const s = document.getElementById('status');
      s.textContent = msg; s.className = 'small status ' + (ok?'ok':'err');
    }

    function lock(){ localStorage.setItem(LOCK_KEY, Date.now().toString()); document.getElementById('submitBtn').disabled = true; }
    function restoreLock(){ if(localStorage.getItem(LOCK_KEY)) document.getElementById('submitBtn').disabled = true; }

    function toRow(){
      return {
        present_a: state.now.a, present_b: state.now.b, present_c: state.now.c,
        future_a: state.fut.a,  future_b: state.fut.b,  future_c: state.fut.c,
        dataset: 'veritas-ai',
        email: document.getElementById('email').value || ''
      };
    }

    async function submitForm(e){
      e.preventDefault();
      if(!document.getElementById('present_a').value || !document.getElementById('future_a').value){
        setStatus('Please place a dot in each triangle before submitting.'); return;
      }
      if(!document.getElementById('consent').checked){ setStatus('Please tick the consent box.'); return; }
      document.getElementById('submitBtn').disabled = true; setStatus('Submitting…', true);
      saveLocal();
      try{
        const resp = await fetch(FORMSPREE_ENDPOINT, {
          method: 'POST',
          headers: { 'Accept': 'application/json' },
          body: new FormData(document.getElementById('resp-form'))
        });
        if(!resp.ok){ throw new Error('Formspree error: '+resp.status); }
        setStatus('Thanks! Your responses were recorded.', true);
        lock();
      } catch(err){
        console.error(err);
        setStatus('Submission failed. You can still use “Download CSV (local backup)”.');
        document.getElementById('submitBtn').disabled = false;
      }
    }

    function downloadCSV(){
      const row = toRow();
      const headers = Object.keys(row);
      const csv = [headers.join(',') + '\n' + headers.map(h=>row[h]).join(',')];
      const blob = new Blob(csv, {type:'text/csv'});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a'); a.href=url; a.download='veritas_values.csv'; a.click(); URL.revokeObjectURL(url);
    }

    function clearDot(which){ state[which]={a:34,b:33,c:33}; setSliders(which,state[which]); updateHidden(which); draw(which); }

    // ======== Init ========
    window.addEventListener('load', ()=>{
      loadFromLocal();
      setSliders('now', state.now); setSliders('fut', state.fut);
      updateHidden('now'); updateHidden('fut');
      bindSliders('now'); bindSliders('fut');
      draw('now'); draw('fut');
      document.getElementById('resp-form').addEventListener('submit', submitForm);
      document.getElementById('downloadBtn').addEventListener('click', downloadCSV);
      document.getElementById('now-clear').addEventListener('click', ()=>clearDot('now'));
      document.getElementById('fut-clear').addEventListener('click', ()=>clearDot('fut'));
      restoreLock();
    });
  </script>
</body>
</html>

   
